<!DOCTYPE html>
<html>
<head>
    <title>Live Status â€“ QUEUELESS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        body {
            margin: 0;
            background: url('/static/bg.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
        }

        /* CENTERED WHITE CARD */
        .status-wrapper {
            width: 520px;
            background: rgba(255,255,255,0.92); /* soft white */
            padding: 35px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.22);
            margin: 50px auto;
            backdrop-filter: blur(6px); /* premium blur effect */
        }

        .status-box {
            background: #f4f6f8;
            padding: 28px;
            border-radius: 14px;
            text-align: center;
            margin-top: 22px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.10);
        }

        .status-box p {
            font-size: 18px;
            font-weight: 600;
            color: #2c2c2c;
            margin: 0;
            padding-bottom: 6px;
        }

        .status-box h1 {
            font-size: 46px;
            font-weight: bold;
            margin: 5px 0 0;
            color: #000;
        }

        /* TOKEN COLORS */
        .green  { color: #1b8a3c !important; }
        .orange { color: #ff9800 !important; }
        .red    { color: #e53935 !important; }

    </style>
</head>

<body>

<!-- TOP BLUE BAR -->
<div class="user-topbar">
    <div class="user-brand">QUEUELESS
        <span>Digital Queue Management System</span>
    </div>
</div>

<!-- PAGE LAYOUT -->
<div class="page-wrapper">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <a href="/user">Home</a>
        <a href="/user/status" class="active">Live Status</a>
        <a href="/user/services">Services</a>
        <a href="/user/help">Help</a>
    </div>

    <!-- MAIN CONTENT CARD -->
    <div class="status-wrapper">
        <h2 style="text-align:center; color:#004aad; margin-bottom:25px; font-size:28px;">
            Your Live Status
        </h2>

        <!-- YOUR TOKEN -->
        <div class="status-box">
            <p>Your Token</p>
            <h1 id="yourToken">--</h1>
        </div>

        <!-- YOUR COUNTER -->
        <div class="status-box">
            <p>Your Counter</p>
            <h1>{{ user_counter if user_counter else '--' }}</h1>
        </div>

        <!-- CURRENT SERVING -->
        <div class="status-box">
            <p>Current Token Serving</p>
            <h1 id="currentServing">--</h1>
        </div>

        <!-- WAITING COUNT -->
        <div class="status-box">
            <p>Total Waiting Tokens</p>
            <h1 id="waitingCount">--</h1>
        </div>

    </div>
</div>

<script>
function updateLive() {

    let myToken = {{ user_token | tojson }};
    let myCounter = {{ user_counter | tojson }};

    fetch("/live_data")
    .then(res => res.json())
    .then(info => {

        document.getElementById("waitingCount").innerText = info.waiting_count;

        fetch("/live_data/" + myCounter)
        .then(r => r.json())
        .then(counterInfo => {

            let servingToken = counterInfo.token;
            document.getElementById("currentServing").innerText =
                servingToken ? servingToken : "--";

            let yt = document.getElementById("yourToken");

            if (!myToken) {
                yt.innerText = "--";
                yt.className = "";
                return;
            }

            let t = Number(myToken);

            /* COLOR BASED ON TOKEN RANGE */
            if (t >= 1 && t <= 10) {
                yt.className = "green";
            }
            else if (t >= 11 && t <= 20) {
                yt.className = "orange";
            }
            else if (t >= 21 && t <= 50) {
                yt.className = "red";
            }
            else {
                yt.className = "red";
            }

            yt.innerText = t;
        });

    });
}

setInterval(updateLive, 1200);
updateLive();
</script>

</body>
</html>