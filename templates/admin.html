<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard â€“ QUEUELESS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
    <div class="brand">
        ADMIN â€“ QUEUELESS
        <span>Digital Queue Management System</span>
    </div>
</div>

<!-- PAGE WRAPPER -->
<div class="admin-wrapper">

    <!-- ADMIN CARD -->
    <div class="admin-card">
        <h2>Token Management</h2>
          <!-- Counter Navigation -->
<div style="margin-bottom:20px;">
    <a href="/display/1" target="_blank">
        <button class="serve-btn">Counter 1</button>
    </a>

    <a href="/display/2" target="_blank">
        <button class="serve-btn">Counter 2</button>
    </a>

    <a href="/display/3" target="_blank">
        <button class="serve-btn">Counter 3</button>
    </a>
</div>

        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Token No</th>
                        <th>Counter</th>
                        <th>Name</th>
                        <th>District</th>
                        <th>Panchayat</th>
                        <th>Ward</th>
                        <th>Purpose</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody id="tokenTableBody">
                {% for row in tokens %}
                    <tr>
                        <td>{{ row.token_number }}</td>
                        <td>{{ row.counter_number }}</td>
                        <td>{{ row.name }}</td>
                        <td>{{ row.district }}</td>
                        <td>{{ row.panchayat }}</td>
                        <td>{{ row.ward }}</td>
                        <td>{{ row.purpose }}</td>
                        <td>{{ row.status }}</td>

                        <td>

                            <!-- SERVE -->
                            {% if row.status != 'Serving' and row.status != 'Done' and row.status != 'Cancelled' %}
                                <button class="serve-btn" onclick="serveToken({{ row.token_number }})">Serve</button>
                            {% endif %}

                            <!-- DELETE (only if Done) -->
                            {% if row.status == 'Done' %}
                                <button class="done-btn" style="background:#dc3545;" onclick="deleteToken({{ row.token_number }})">Delete</button>
                            {% endif %}

                            <!-- CANCEL (until Done) -->
                            {% if row.status != 'Done' and row.status != 'Cancelled' %}
                                <button class="done-btn" style="background:#6c757d;" onclick="cancelToken({{ row.token_number }})">Cancel</button>
                            {% endif %}

                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<!-- JS -->
<script>

function serveToken(tokenNo) {
    fetch("/serve_token/" + tokenNo)
        .then(() => refreshTable());
}

function doneToken(tokenNo) {
    fetch("/done_token/" + tokenNo)
        .then(() => refreshTable());
}

function cancelToken(tokenNo) {
    fetch("/cancel_token/" + tokenNo)
        .then(() => refreshTable());
}

/* ðŸ”¥ FIXED HERE */
function deleteToken(tokenNo) {
    fetch("/done_token/" + tokenNo)
        .then(() => refreshTable());
}

function refreshTable() {
    fetch("/admin/table_reload")
        .then(res => res.text())
        .then(html => {
            document.getElementById("tokenTableBody").innerHTML = html;
        });
}

setInterval(refreshTable, 3000);

</script>

</body>
</html>





